<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tableau de Bord - WarabaGuinée</title>
    {% load static %}
    {% load custom_filters %}
    {% load widget_tweaks %}
    {{ pred.month|mois_fr }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
         <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        *{
          padding: 0; margin: 0;
          font-family:'Poppins', sans-serif;
          box-sizing: border-box;
          transition: all.2 linear;
          text-decoration: none;
          list-style-type: none;border:none;
      }
      html{
          font-size: 80.5%;
          scroll-padding-top: 7em;
          scroll-behavior: smooth;
      }
      body {
          font-family: 'Orbitron', sans-serif;
          margin: 0;
          padding: 0;
          background: #fff;
          color: #0b0c0e;
          overflow-x: hidden;
          display: flex;
          flex-direction: column;
          height: 100vh;
      }
      .top-bar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 5;
          height: 60px;
          background-color: #333;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 0 20px;
      }
      .top-bar h1 {
          flex: 1;
          text-align: center;
          font-size: 24px;
          text-transform: uppercase;
          letter-spacing: 2px;
          font-weight: 700;
          color: #fff;
          margin: 0;
      }
      @media screen and (max-width: 767px) {
          .top-bar {
              padding: 0 10px;
          }
          .top-bar h1 {
              font-size: 18px;
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
          }
          .menu-btn {
              font-size: 20px;
          }
      }
     /* Style du sidebar */
/* Style du sidebar */
.sidebar {
    width: 250px;
    height: 100vh;
    position: fixed;
    left: -250px;
    top: 0; /* Commence depuis le haut de la page */
    background-color: #333;
    padding-top: 60px; /* Réduit le padding-top de 80px à 60px */
    overflow-y: auto;
    transition: left 0.3s ease;
    z-index: 6; /* Plus élevé que le top-bar */
}

.sidebar.active {
    left: 0;
}

.sidebar a {
    display: block;
    padding: 15px 20px;
    color: #fff;
    text-decoration: none;
    font-size: 16px;
    text-transform: uppercase;
    transition: background 0.3s;
    font-weight: 600;
    min-height: 50px;
}

.sidebar a:hover {
    background-color: #FF8C00;

}

.sidebar hr {
    text-align: center;
    color: white;
    margin-top: 10px;
    font-size: 20px;
}

.sidebar h2 {
    text-align: center;
    margin-top: 10px;
    font-size: 20px;
    color: white;
}

.logo-container {
    text-align: center;
    padding: 5px; /* Réduit le padding de 15px à 5px */
    margin-top: -20px; /* Ajoute une marge négative pour remonter le logo */
}

.logo {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid #FF8C00;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    object-fit: cover;
    transition: all 0.3s ease;
  }
  
  .logo:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(255, 140, 0, 0.3);
  }
  

.menu-btn {
    background: none;
    border: none;
    color: #fff;
    font-size: 24px;
    cursor: pointer;
    z-index: 1000;
    padding: 10px;
    display: flex;
    align-items: center;
}

.menu-btn:hover {
    transform: scale(1.1);
}


/* Style du contenu principal */
.content {
    margin-left: 0;
    padding: 80px 20px 20px; /* Augmente le padding-top pour éviter le chevauchement avec top-bar */
    min-height: calc(100vh - 60px); /* Ajuste la hauteur en tenant compte du top-bar */
    transition: margin-left 0.3s ease;
    overflow-x: hidden; /* Empêche le débordement horizontal */
}





/* Responsiveness pour les petits écrans (moins de 767px) */
@media screen and (max-width: 767px) {
    .content {
        margin: 0;
        padding: 80px 15px 20px; /* Ajuste le padding pour mobile */
        width: 100%;
        overflow-x: hidden;
    }

    .sidebar {
        width: 100%;
        left: -100%;
        padding-top: 60px; /* Réduit le padding-top sur mobile */
    }

    .sidebar.active {
        left: 0;
    }

    .menu-btn {
        display: block;
    }

    .card {
        width: 100%;
        margin: 10px 0;
    }

    .row {
        margin-left: 0;
        margin-right: 0;
    }

    .container {
        padding-left: 10px;
        padding-right: 10px;
    }

    /* Lorsque le sidebar est actif, désactiver le défilement du body */
    body.no-scroll {
        overflow: hidden;
    }
}

/* Pour les écrans plus grands (à partir de 768px) */
@media screen and (min-width: 768px) {
    .content {
        margin-left: 250px;
    }

    .sidebar {
        left: 0;
    }

    .menu-btn {
        display: none;
    }

    /* Cacher le bouton croix sur les grands écrans */
    .close-sidebar-btn {
        display: none;
    }
}

:root {
    --bg-color: rgba(255, 255, 255, 0.97);
    --text-color: #333;
    --border-color: rgba(0, 0, 0, 0.1);
    --progress-gradient: linear-gradient(90deg, rgba(78, 115, 255, 0.8), rgba(46, 204, 113, 0.8));
    --mobile-breakpoint: 768px;
  }
  
  .messages-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 20px;
    z-index: 9999;
    pointer-events: none;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .messages-container {
    max-width: 600px;
    width: 90%;
    pointer-events: auto;
    padding: 10px;
  }
  
  .notification-modal {
    position: relative;
    margin-bottom: 15px;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    transform: translateY(-30px) scale(0.95);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    backdrop-filter: blur(12px);
    overflow: hidden;
    background: var(--bg-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    width: 100%;
    box-sizing: border-box;
  }
  
  .notification-modal.show {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  
  .notification-modal.closing {
    transform: translateY(-20px) scale(0.95);
    opacity: 0;
  }
  
  .notification-icon {
    position: absolute;
    left: 20px;
    top: 20px;
    font-size: 24px;
    color: var(--primary-color, #4e73ff);
  }
  
  .notification-content {
    padding-left: 40px;
    padding-right: 20px;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
  
  .pulse {
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
  
  .close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 16px;
    opacity: 0.6;
    transition: all 0.2s ease-out;
    color: inherit;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    touch-action: manipulation;
  }
  
  .close-btn:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.05);
  }
  
  .progress-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    width: 100%;
    background: var(--progress-gradient);
    transform-origin: left;
    transition: width 5s linear;
  }
  
  /* Effet de "glow" subtil */
  .notification-modal::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.2);
    box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.15);
  }
  
  /* Animation d'entrée spécifique pour chaque notification */
  .notification-modal:nth-child(1) { transition-delay: 0.1s; }
  .notification-modal:nth-child(2) { transition-delay: 0.2s; }
  .notification-modal:nth-child(3) { transition-delay: 0.3s; }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .messages-overlay {
        padding-top: 10px;
        align-items: center;
        justify-content: flex-start;
        flex-direction: column;
    }
    
    .messages-container {
        width: 95%;
        max-width: 100%;
        padding: 5px;
    }
    
    .notification-modal {
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 10px;
    }
    
    .notification-icon {
        left: 15px;
        top: 15px;
        font-size: 20px;
    }
    
    .notification-content {
        padding-left: 35px;
        padding-right: 15px;
        font-size: 14px;
    }
    
    .close-btn {
        top: 10px;
        right: 10px;
        width: 24px;
        height: 24px;
        font-size: 14px;
    }
    
    .progress-bar {
        height: 2px;
    }
  }
  
  @media (max-width: 480px) {
    .notification-modal {
        padding: 12px;
    }
    
    .notification-icon {
        left: 12px;
        top: 12px;
        font-size: 18px;
    }
    
    .notification-content {
        padding-left: 30px;
        padding-right: 10px;
    }
    
    .notification-modal::after {
        display: none; /* Supprime l'effet glow sur petits écrans */
    }
  }
  
  /* Support pour les appareils tactiles */
  @media (hover: none) {
    .close-btn {
        opacity: 0.8; /* Rend le bouton plus visible sur mobile */
        background: rgba(0, 0, 0, 0.1);
    }
  }
  
  /* Amélioration pour les très grands écrans */
  @media (min-width: 1600px) {
    .messages-container {
        max-width: 700px;
    }
  }
  


  /* Couleurs personnalisées */
.bg-gradient-ai {
    background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
}
.bg-soft-primary {
    background-color: rgba(58, 123, 213, 0.1);
}
.bg-soft-light {
    background-color: rgba(248, 249, 250, 0.7);
}

/* Éléments IA */
.ia-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}
.ia-avatar-small {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
}
.ia-message {
    border-left: 4px solid #3a7bd5;
}
.ia-product-card {
    transition: all 0.3s ease;
    border-left: 4px solid #3a7bd5;
}
.ia-product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}
.ia-badge {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    display: inline-flex;
    align-items: center;
}
.month-badge {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: bold;
    color: white;
    letter-spacing: 1px;
}
.ia-progress-container {
    background: rgba(0,0,0,0.03);
    padding: 12px;
    border-radius: 10px;
}
.legend-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
}
.product-img {
    width: 50px;
    height: 50px;
    object-fit: contain;
    border-radius: 8px;
    border: 1px solid #eee;
}
.section-title {
    font-size: 0.85rem;
    color: #6c757d;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}
.ia-empty-state {
    border: 2px dashed #dee2e6;
}
.progress-circle {
    transition: stroke-dasharray 0.6s ease;
}
.product-img-container {
    transition: transform 0.3s ease;
}
.product-img-container:hover {
    transform: scale(1.05);
}
.month-badge {
    transition: all 0.3s ease;
}
.month-badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

 /* Styles spécifiques pour mobile */
 @media (max-width: 768px) {
    .mobile-input {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        height: auto;
    }
    
    #ventesEnCours th, 
    #ventesEnCours td {
        padding: 0.3rem;
        font-size: 0.85rem;
    }
    
    #ventesEnCours th {
        white-space: nowrap;
    }
    
    .table-responsive {
        border: none;
    }
    
    #ventesEnCours {
        width: 100%;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
}

.mini-spinner {
    display: none;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    margin-left: 5px;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@media (max-width: 576px) {
    .mini-spinner {
        width: 14px;
        height: 14px;
    }
}
 </style>
</head>
<body>
   
<audio id="notification-sound" src="{% static 'son2.mp3' %}" preload="auto"></audio>

{% if messages %}
<div class="messages-overlay" id="messages-overlay">
  <div class="messages-container">
      {% for message in messages %}
          <div class="notification-modal" id="notification-{{ forloop.counter }}" data-theme="{{ theme }}">
              <div class="notification-icon">
                  <i class="fas fa-robot pulse"></i>
              </div>
              
              <div class="notification-content">
                  <div class="message">
                      {{ message }}
                  </div>
              </div>
              
              <button class="close-btn" onclick="closeNotification(this)" aria-label="Fermer">
                  <i class="fas fa-times"></i>
              </button>
              
              <div class="progress-bar"></div>
          </div>
      {% endfor %}
  </div>
</div>
{% endif %}

    <div class="top-bar">
        <button class="menu-btn" onclick="toggleSidebar()">☰</button>
        <h1>Tableau de Bord - WarabaGuinée</h1>
    </div>
    <div class="sidebar" id="sidebar">
        <button class="close-btn" onclick="toggleSidebar()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;">&times;</button>
        <div class="logo-container">
            <img src="{% static 'lo.webp' %}" alt="Logo" class="logo">
        </div>
        <h2>WarabaGuinée</h2>
        <hr>    
    <a href="{% url 'table' %}"><i class="fas fa-home"></i> Tableau de bord</a>
    <a href="{% url 'site' %}"><i class="fas fa-store"></i> Voir ma boutique</a>
    <a href="{% url 'sliders' %}"><i class="fas fa-images"></i> Gestion sliders</a>
    <a href="{% url 'produits' %}"><i class="fas fa-box"></i> Gestion produits</a>
    <a href="{% url 'localisation' %}"><i class="fas fa-map-marker-alt"></i> Localisation</a>
    <a href="{% url 'commandes_utilisateur' %}"><i class="fas fa-shopping-cart"></i>Commandes</a>
    <a href="{% url 'vente_list' %}"><i class="fas fa-chart-line"></i> Ventes en hausse</a>
    <a href="{% url 'update_quantite' %}"><i class="fas fa-cogs"></i> Gestion des stocks</a>
    <a href="{% url 'statistiques_commandes' %}"><i class="fas fa-chart-bar"></i>Croissance des commandes</a>
    <a href="{% url 'statut_validation_compte' %}"><i class="fas fa-headset"></i> Support client</a>
    <a href="{% url 'profil' %}"><i class="fas fa-cogs"></i> Paramètres</a>
    <a href="{% url 'gestion_boutique' %}"><i class="fas fa-upload"></i> Publier le site</a>
    <a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i> Déconnexion</a>
    <a href=""></a>
    </div>
    
    <div class="content">
        <div class="container-fluid px-0">
            <div class="container-fluid px-4">
                <h1 class="mt-4"><i class="fas fa-chart-line me-2"></i>Tableau de Bord des Ventes</h1>
                
                <!-- Filtres -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-filter me-1"></i>
                        Filtres
                    </div>
                    <div class="card-body">
                        <form method="get" class="row g-3">
                            <div class="col-md-3 col-6">
                                <label for="jour_unique" class="form-label">Jour spécifique</label>
                                <input type="date" class="form-control form-control-lg" id="jour_unique" name="jour_unique" value="{{ filtres.jour_unique }}">
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="debut_jour" class="form-label">Date début</label>
                                <input type="date" class="form-control form-control-lg" id="debut_jour" name="debut_jour" value="{{ filtres.intervalle_jours_debut }}">
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="fin_jour" class="form-label">Date fin</label>
                                <input type="date" class="form-control form-control-lg" id="fin_jour" name="fin_jour" value="{{ filtres.intervalle_jours_fin }}">
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="produit" class="form-label">Produit</label>
                                <select class="form-select form-select-lg" id="produit" name="produit">
                                    <option value="">Tous</option>
                                    {% for produit in produits %}
                                    <option value="{{ produit.id }}" {% if filtres.produit_id == produit.id|stringformat:"s" %}selected{% endif %}>{{ produit.nom }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="marque" class="form-label">Marque</label>
                                <select class="form-select form-select-lg" id="marque" name="marque">
                                    <option value="">Toutes</option>
                                    {% for marque in marques %}
                                    <option value="{{ marque }}" {% if filtres.marque == marque %}selected{% endif %}>{{ marque }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="tag" class="form-label">Catégorie</label>
                                <select class="form-select form-select-lg" id="tag" name="tag">
                                    <option value="">Toutes</option>
                                    {% for tag in tags %}
                                    <option value="{{ tag.nom }}" {% if filtres.tag == tag.nom %}selected{% endif %}>{{ tag.nom }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3 col-6">
                                <label for="annee_analyse" class="form-label">Année analyse</label>
                                <input type="number" class="form-control form-control-lg" id="annee_analyse" name="annee_analyse" min="2000" max="2100" value="{{ filtres.annee_analyse }}">
                            </div>
                            <div class="col-12 mt-3">
                                <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-search me-1"></i>Filtrer</button>
                                <a href="{% url 'vente_list' %}" class="btn btn-secondary btn-lg"><i class="fas fa-undo me-1"></i>Réinitialiser</a>
                            </div>
                        </form>
                    </div>
                </div>
                
              <!-- Cartes de Résumé -->
                <div class="row">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-start-success shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col me-2">
                                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                            Revenu Total</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{total_revenu|format_prix}} FG</div>
                                    </div>
                                    <div class="col-auto">
                                    <i class="fas fa-hand-holding-usd fa-2x text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-start-primary shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col me-2">
                                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                            Coût Total</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{total_cout|format_prix}} FG</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-money-bill-wave fa-2x text-primary"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-start-{% if total_profit < 0 %}danger{% else %}info{% endif %} shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col me-2">
                                        <div class="text-xs font-weight-bold text-{% if total_profit < 0 %}danger{% else %}info{% endif %} text-uppercase mb-1">
                                            {% if total_profit < 0 %}<i class="fas fa-exclamation-triangle me-1"></i>{% endif %}
                                            Profit ({{ pourcentage_profit }}%)
                                        </div>
                                        <div class="h5 mb-0 font-weight-bold text-{% if total_profit < 0 %}danger{% else %}gray-800{% endif %}">
                                            {{total_profit|format_prix}} FG
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-{% if total_profit < 0 %}exclamation-circle{% else %}chart-pie{% endif %} fa-2x text-{% if total_profit < 0 %}danger{% else %}info{% endif %}"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-start-warning shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col me-2">
                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                            Total Ventes</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{total_ventes|format_prix}}</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-shopping-cart fa-2x text-warning"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Graphiques et Analyses -->
                <div class="row">
                    <!-- Graphique des ventes par mois -->
                    <div class="col-lg-6 mb-4">
                        <div class="card shadow mb-4 h-100">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-calendar-alt me-1"></i> Ventes par Mois
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height: 400px; width: 100%;">
                                    <canvas id="ventesParMoisChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Graphique des ventes par jour de semaine -->
                    <div class="col-lg-6 mb-4">
                        <div class="card shadow mb-4 h-100">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-calendar-day me-1"></i> Ventes par Jour de Semaine
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height: 400px; width: 100%;">
                                    <canvas id="ventesParJourChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Tableaux d'Analyse -->
                <div class="row">
                    <!-- Top Produits -->
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header bg-success text-white py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-trophy me-1"></i> Top 5 Produits
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Produit</th>
                                                <th>Image</th>
                                                <th class="text-end">Quantité</th>
                                                <th class="text-end">Profit</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for produit in products_performance.top_produits %}
                                            <tr>
                                                <td>{{ produit.nom_produit|truncatechars:20 }}</td>
                                                <td>
                                                    {% if produit.image %}
                                                    <img src="{{ produit.image }}" alt="{{ produit.nom_produit }}" style="width: 50px; height: auto;">
                                                    {% else %}
                                                    <img src="{% static 'images/default-product-image.jpg' %}" alt="Image par défaut" style="width: 50px; height: auto;">
                                                    {% endif %}
                                                </td>
                                                <td class="text-end">{{ produit.total_vendu }}</td>
                                                <td class="text-end text-success">{{ produit.total_profit|format_prix}} FG</td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="text-center">Aucune donnée disponible</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Produits Sous-Performance -->
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header bg-danger text-white py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-exclamation-triangle me-1"></i> Produits en Difficulté
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Produit</th>
                                                <th>Image</th>
                                                <th class="text-end">Quantité</th>
                                                <th class="text-end">Perte</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for produit in products_performance.produits_sous_performance %}
                                            <tr>
                                                <td>{{ produit.nom_produit|truncatechars:20 }}</td>
                                                <td>
                                                    {% if produit.image %}
                                                    <img src="{{ produit.image }}" alt="{{ produit.nom_produit }}" style="width: 50px; height: auto;">
                                                    {% else %}
                                                    <img src="{% static 'images/default-product-image.jpg' %}" alt="Image par défaut" style="width: 50px; height: auto;">
                                                    {% endif %}
                                                </td>
                                                <td class="text-end">{{ produit.total_vendu }}</td>
                                                <td class="text-end text-danger">{{ produit.total_profit|format_prix}} FG</td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="text-center">Aucun produit en difficulté</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Alertes Stock -->
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header bg-warning text-dark py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-box-open me-1"></i> Alertes Stock
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Produit</th>
                                                <th class="text-end">Stock</th>
                                                <th class="text-end">Jours restants</th>
                                                <th class="text-end">Image</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for produit in inventory_analysis.alertes_stock %}
                                            <tr class="{% if produit.niveau == 'rupture' %}table-danger{% else %}table-warning{% endif %}">
                                                <td>{{ produit.produit|truncatechars:20 }}</td>
                                                <td class="text-end">{{ produit.stock }}</td>
                                                <td class="text-end">
                                                    {% if produit.niveau == 'rupture' %}
                                                        N/A
                                                    {% else %}
                                                        <strong>Faible stock</strong>
                                                    {% endif %}
                                                </td>
                                                <td class="text-end">
                                                    {% if produit.image %}
                                                        <img src="{{produit.image}}" alt="{{ produit.produit }}" style="max-width: 50px; max-height: 50px;">
                                                    {% else %}
                                                        <span>Aucune image</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="text-center">Aucune alerte de stock</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Surstock -->
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header bg-success text-dark py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-box-open me-1"></i> Surstock
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Produit</th>
                                                <th class="text-end">Stock</th>
                                                <th class="text-end">Jours restants</th>
                                                <th class="text-end">Image</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for produit in inventory_analysis.surstock %}
                                            <tr class="table-success">
                                                <td>{{ produit.produit|truncatechars:20 }}</td>
                                                <td class="text-end">{{ produit.stock_actuel }}</td>
                                                <td class="text-end">
                                                    {% if produit.mois_restants %}
                                                    {{ produit.mois_restants|floatformat:1 }} mois
                                                    {% else %}
                                                    N/A
                                                    {% endif %}
                                                </td>
                                                <td class="text-end">
                                                    {% if produit.image %}
                                                    <img src="{{ produit.image }}" alt="{{ produit.produit }}" width="50" height="50">
                                                    {% else %}
                                                    <span>Aucune image</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="text-center">Aucun produit en surstock</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Rotation des Stocks -->
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header bg-info text-dark py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-sync-alt me-1"></i> Rotation des Stocks
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Produit</th>
                                                <th class="text-end">Rotation</th>
                                                <th class="text-end">Image</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for produit in inventory_analysis.rotation_stock %}
                                            <tr>
                                                <td>{{ produit.produit|truncatechars:20 }}</td>
                                                <td class="text-end">{{ produit.rotation|floatformat:2 }}</td>
                                                <td class="text-end">
                                                    {% if produit.image %}
                                                    <img src="{{ produit.image }}" alt="{{ produit.produit }}" width="50" height="50">
                                                    {% else %}
                                                    <span>Aucune image</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="3" class="text-center">Aucune donnée de rotation</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Section IA - WarabaAI Assistant Commercial -->
                    <div class="col-lg-6 mb-4">
                        <div class="card shadow h-100 border-0" style="border-radius: 16px; overflow: hidden;">
                            <!-- En-tête avec identité IA -->
                            <div class="card-header bg-gradient-waraba text-white py-3" style="background: linear-gradient(135deg, #6e48aa 0%, #9d50bb 100%);">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <div class="ia-avatar me-3" style="width: 48px; height: 48px; background-color: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-robot fa-lg" style="color: white;"></i>
                                        </div>
                                        <div>
                                            <h5 class="mb-0 fw-bold">WarabaAI Assistant</h5>
                                            <small class="opacity-75">Analyse prédictive avancée • Version Pro</small>
                                        </div>
                                    </div>
                                    <button id="toggleIA" class="btn btn-sm btn-light rounded-pill px-3" style="border: none;">
                                        <i class="fas fa-eye me-1"></i> <span class="toggle-text">Explorer</span>
                                    </button>
                                </div>
                            </div>
            
                            <!-- Corps principal -->
                            <div class="card-body p-0">
                                <!-- Message d'accueil IA -->
                                <div id="iaWelcome" class="ia-message p-4" style="background-color: #f8f9fa; border-bottom: 1px solid #eee;">
                                    <div class="d-flex">
                                        <div class="ia-avatar-small me-3" style="width: 36px; height: 36px; background-color: #6e48aa; color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-sparkles"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-2 fw-bold" style="color: #6e48aa;">Bonjour, je suis WarabaAI</h6>
                                            <p class="mb-0 small text-muted">Votre assistant d'intelligence artificielle pour optimiser vos ventes et stocks. Cliquez sur "Explorer" pour découvrir mes analyses prédictives.</p>
                                        </div>
                                    </div>
                                </div>
            
                                <!-- Contenu IA (masqué par défaut) -->
                                <div id="iaContent" style="display: none;">
                                    <!-- Section Légende -->
                                    <div class="ia-section p-4" style="background-color: #f5f3ff; border-bottom: 1px solid #e9e3ff;">
                                        <h6 class="d-flex align-items-center mb-3 fw-bold" style="color: #6e48aa;">
                                            <i class="fas fa-lightbulb me-2"></i> Comment interpréter ces données
                                        </h6>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <div class="d-flex align-items-center p-3 bg-white rounded-3 shadow-sm h-100">
                                                    <div class="legend-dot me-3" style="width: 16px; height: 16px; background-color: #4caf50; border-radius: 50%;"></div>
                                                    <div>
                                                        <small class="d-block fw-bold">Haute fiabilité</small>
                                                        <small class="text-muted">(70-100%) - Très probable</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="d-flex align-items-center p-3 bg-white rounded-3 shadow-sm h-100">
                                                    <div class="legend-dot me-3" style="width: 16px; height: 16px; background-color: #ff9800; border-radius: 50%;"></div>
                                                    <div>
                                                        <small class="d-block fw-bold">Confiance moyenne</small>
                                                        <small class="text-muted">(40-69%) - À surveiller</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="d-flex align-items-center p-3 bg-white rounded-3 shadow-sm h-100">
                                                    <div class="legend-dot me-3" style="width: 16px; height: 16px; background-color: #f44336; border-radius: 50%;"></div>
                                                    <div>
                                                        <small class="d-block fw-bold">Faible certitude</small>
                                                        <small class="text-muted">(0-39%) - Données insuffisantes</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
            
                                    <!-- Résultats IA -->
                                    {% for product_id, data in sales_predictions.items %}
                                    <div class="ia-product-card p-4" style="border-bottom: 1px solid #eee;">
                                        <!-- En-tête produit -->
                                        <div class="ia-product-header d-flex justify-content-between align-items-start mb-4">
                                            <div class="d-flex align-items-start" style="gap: 16px;">
                                                {% if data.product_image %}
                                                <div class="product-img-container" style="width: 80px; height: 80px; border-radius: 12px; overflow: hidden; flex-shrink: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                                    <img src="{{ data.product_image }}" class="img-fluid h-100 w-100 object-fit-cover" alt="{{ data.product_name }}" style="object-fit: cover;">
                                                </div>
                                                {% endif %}
                                                <div>
                                                    <h5 class="mb-2 fw-bold" style="color: #333;">
                                                        {{ data.product_name }}
                                                    </h5>
                                                    <div class="d-flex flex-wrap" style="gap: 8px;">
                                                        <span class="ia-badge d-flex align-items-center px-3 py-1 rounded-pill" style="background-color: {% if data.stock_risk %}#fee2e2{% else %}#e0f7fa{% endif %}; font-size: 0.8rem;">
                                                            <i class="fas fa-boxes me-1" style="color: {% if data.stock_risk %}#dc2626{% else %}#00acc1{% endif %};"></i> 
                                                            <span style="color: {% if data.stock_risk %}#dc2626{% else %}#007c91{% endif %};">Stock: {{ data.current_stock }}</span>
                                                        </span>
                                                        <span class="ia-badge d-flex align-items-center px-3 py-1 rounded-pill" style="background-color: #f0f4ff; font-size: 0.8rem;">
                                                            <i class="fas fa-bullseye me-1" style="color: #4c6ef5;"></i> 
                                                            <span style="color: #364fc7;">Prévision: {{ data.total_predicted|floatformat }}</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
            
                                        <!-- Section Prévisions -->
                                        <div class="ia-forecast-section mt-4">
                                            <h6 class="section-title mb-3 fw-bold d-flex align-items-center" style="color: #6e48aa;">
                                                <i class="fas fa-chart-line me-2"></i> Prévisions détaillées
                                            </h6>
                                            
                                            <div class="row g-3">
                                                {% for pred in data.predictions %}
                                                <div class="col-md-4">
                                                    <div class="ia-month-card p-3 h-100 rounded-3 bg-white shadow-sm border-0">
                                                        <!-- Nom du mois en français -->
                                                        <div class="month-header text-center mb-3">
                                                            <span class="month-badge d-inline-block px-3 py-1 rounded-pill fw-bold" 
                                                                style="font-size: 0.75rem;
                                                                    background-color: {% if pred.confidence > 69 %}#e6f4ea{% elif pred.confidence > 39 %}#fff8e6{% else %}#ffebee{% endif %};
                                                                    color: {% if pred.confidence > 69 %}#0a7b3e{% elif pred.confidence > 39 %}#b35d00{% else %}#c62828{% endif %};">
                                                                    {% with pred.month|stringformat:"s" as month_str %}
                                                                    {% with month_str|slice:"-2:" as month %}
                                                                        {% if month == '01' %}JANVIER
                                                                        {% elif month == '02' %}FÉVRIER
                                                                        {% elif month == '03' %}MARS
                                                                        {% elif month == '04' %}AVRIL
                                                                        {% elif month == '05' %}MAI
                                                                        {% elif month == '06' %}JUIN
                                                                        {% elif month == '07' %}JUILLET
                                                                        {% elif month == '08' %}AOÛT
                                                                        {% elif month == '09' %}SEPTEMBRE
                                                                        {% elif month == '10' %}OCTOBRE
                                                                        {% elif month == '11' %}NOVEMBRE
                                                                        {% elif month == '12' %}DÉCEMBRE
                                                                        {% else %}{{ month_str }}
                                                                        {% endif %}
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            </span>
                                                        </div>
                                                        
                                                        <!-- Cercle de progression -->
                                                        <div class="ia-progress-container mb-3 d-flex justify-content-center">
                                                            <div class="position-relative" style="width: 100px; height: 100px;">
                                                                <svg class="progress-circle" width="100" height="100" viewBox="0 0 100 100">
                                                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#eee" stroke-width="8"/>
                                                                    <circle cx="50" cy="50" r="45" fill="none" 
                                                                        stroke="{% if pred.confidence > 69 %}#4caf50{% elif pred.confidence > 39 %}#ff9800{% else %}#f44336{% endif %}" 
                                                                        stroke-width="8" stroke-linecap="round"
                                                                        stroke-dasharray="{{ pred.confidence }} 100" transform="rotate(-90 50 50)"/>
                                                                </svg>
                                                                <div class="position-absolute top-50 start-50 translate-middle text-center">
                                                                    <div class="fw-bold" style="font-size: 1.25rem; color: #333;">{{ pred.confidence }}%</div>
                                                                    <div class="small text-muted">confiance</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Ventes prévues -->
                                                        <div class="ia-sales-prediction text-center mt-3">
                                                            <div class="d-flex flex-column">
                                                                <span class="text-muted small mb-1">Ventes estimées</span>
                                                                <span class="fw-bold" style="font-size: 1.5rem; color: #6e48aa;">
                                                                    {{ pred.predicted_sales|floatformat }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
            
                                        <!-- Conseil IA -->
                                        <div class="ia-advice mt-4 p-3 rounded-3" style="background-color: {% if data.stock_risk %}#fff0f0{% else %}#f0f9ff{% endif %}; border-left: 4px solid {% if data.stock_risk %}#ff6b6b{% else %}#6e48aa{% endif %};">
                                            <div class="d-flex" style="gap: 12px;">
                                                <div class="ia-avatar-small flex-shrink-0" style="width: 36px; height: 36px; background-color: {% if data.stock_risk %}#ff6b6b{% else %}#6e48aa{% endif %}; color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas {% if data.stock_risk %}fa-exclamation{% else %}fa-check{% endif %}"></i>
                                                </div>
                                                <div>
                                                    <h6 class="fw-bold mb-1" style="color: {% if data.stock_risk %}#dc2626{% else %}#6e48aa{% endif %};">
                                                        {% if data.stock_risk %}🔔 Attention : Risque de rupture{% else %}✅ Stock optimal{% endif %}
                                                    </h6>
                                                    <p class="mb-0 small" style="color: #555;">
                                                        {% if data.stock_risk %}
                                                        Selon mes analyses, vous devriez commander <strong>{{ data.total_predicted|subtract:data.current_stock|floatformat }} unités</strong> supplémentaires pour couvrir la demande prévue des 3 prochains mois.
                                                        {% else %}
                                                        Votre stock actuel couvre confortablement la demande prévue. Bonne gestion !
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="ia-empty-state text-center py-5" style="background-color: #f8f9fa;">
                                        <div class="mb-4">
                                            <i class="fas fa-chart-pie fa-3x" style="color: #9d50bb; opacity: 0.5;"></i>
                                        </div>
                                        <h5 class="mb-2 fw-bold" style="color: #6e48aa;">Analyse en cours</h5>
                                        <p class="text-muted mb-4 mx-auto" style="max-width: 400px;">
                                            WarabaAI collecte et analyse vos données pour fournir des prévisions précises. Revenez dans 24h pour des résultats détaillés.
                                        </p>
                                        <button class="btn btn-sm rounded-pill px-4" style="background-color: #6e48aa; color: white;">
                                            <i class="fas fa-bell me-1"></i> M'alerter
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
            
                            <!-- Pied de page IA -->
                            <div class="card-footer py-3" style="background-color: #f8f9fa; border-top: 1px solid #eee;">
                                <div class="d-flex justify-content-between align-items-center small">
                                    <span class="text-muted d-flex align-items-center">
                                        <i class="fas fa-shield-alt me-2" style="color: #9d50bb;"></i>
                                        Données sécurisées et confidentielles
                                    </span>
                                    <span class="text-muted d-flex align-items-center">
                                        <i class="fas fa-sync-alt me-2" style="color: #9d50bb;"></i>
                                        Dernière actualisation : {% now "H:i" %} • Prochaine :{% heure_plus 60 "%H:%M" %}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
            
                   <!-- Ventes en Cours -->
                    <div class="col-12 mb-4">
                        <form method="post" id="ventesForm">
                            {% csrf_token %}

                            <!-- Barre de titre -->
                            <div class="bg-success text-white px-3 py-2 rounded-top d-flex align-items-center">
                                <i class="fas fa-clock me-2"></i>
                                <h5 class="mb-0">Ventes en attente</h5>
                            </div>

                            <div class="table-responsive border border-top-0 rounded-bottom">
                                <table class="table table-bordered table-hover mb-0" id="ventesEnCours">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="5%"><input type="checkbox" id="selectAll" class="form-check-input"></th>
                                            <th width="20%">Produit</th>
                                            <th width="15%">Image</th>
                                            <th width="15%" class="text-end">Prix Achat</th>
                                            <th width="15%" class="text-end">Prix Vente</th>
                                            <th width="10%" class="text-end">Quantité</th>
                                            <th width="10%" class="text-end">Profit</th>
                                            <th width="10%" class="text-end">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for vente in ventes %}
                                        <tr>
                                            <td>
                                                <input type="checkbox" name="vente_id" value="{{ vente.id }}" class="form-check-input">
                                            </td>
                                            <td>{{ vente.nom_produit|truncatechars:15 }}</td>
                                            <td>
                                                {% if vente.image_produit %}
                                                    <img src="{{ vente.image_produit.url }}" class="img-thumbnail" style="max-height:40px; width:auto;">
                                                {% else %}
                                                    <span class="text-muted small">-</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                <input type="number" name="prix_achat_{{ vente.id }}" class="form-control form-control-sm text-end mobile-input" step="0.01" value="{{ vente.prix_achat|floatformat:2 }}">
                                            </td>
                                            <td class="text-end">
                                                <input type="number" name="prix_vente_{{ vente.id }}" class="form-control form-control-sm text-end mobile-input" step="0.01" value="{{ vente.prix_vente|floatformat:2 }}">
                                            </td>
                                            <td class="text-end">
                                                <input type="number" name="quantite_vendue_{{ vente.id }}" class="form-control form-control-sm text-end mobile-input" min="1" value="{{ vente.quantite_vendue }}">
                                            </td>
                                            <td class="text-end small">{{ vente.get_profit_unitaire|floatformat:2 }} FG</td>
                                            <td class="text-end small">{{ vente.get_total|floatformat:2 }} FG</td>
                                        </tr>
                                        {% empty %}
                                        <tr><td colspan="8" class="text-center">Aucune vente en cours</td></tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <!-- Boutons d'action -->
                            <div class="mt-3 d-flex justify-content-between flex-wrap">
                                <button type="button" class="btn btn-danger mb-2 flex-grow-1 mx-1" id="deleteSelected" {% if not ventes %}disabled{% endif %}>
                                    <i class="fas fa-trash-alt me-1"></i> Supprimer
                                    <span class="mini-spinner"></span>
                                </button>
                                <button type="button" class="btn btn-success mb-2 flex-grow-1 mx-1" id="validateSelected" {% if not ventes %}disabled{% endif %}>
                                    <i class="fas fa-check-circle me-1"></i> Valider
                                    <span class="mini-spinner"></span>
                                </button>
                            </div>

                            <!-- Champ action caché -->
                            <input type="hidden" name="form_action" id="formActionInput" value="">
                        </form>
                    </div>
                                
                    <!-- Ventes Terminées -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-clipboard-check me-1"></i>
                                Historique des Ventes
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="ventesTerminees">
                                        <thead class="table-light">
                                            <tr>
                                                <th width="20%">Produit</th>
                                                <th width="10%">Image</th>
                                                <th width="10%" class="text-end">Prix Achat</th>
                                                <th width="10%" class="text-end">Prix Vente</th>
                                                <th width="10%" class="text-end">Quantité</th>
                                                <th width="10%" class="text-end">Profit Unitaire</th>
                                                <th width="10%" class="text-end">Total</th>
                                                <th width="10%">Date</th>
                                                <th width="10%">Statut</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for vente in ventes_terminees %}
                                            <tr>
                                                <td>{{ vente.nom_produit }}</td>
                                                <td>
                                                    {% if vente.produit and vente.produit.image %}
                                                    <img src="{{ vente.produit.image.url }}" alt="{{ vente.nom_produit }}" class="img-thumbnail" style="max-height: 50px;">
                                                    {% elif vente.image_produit %}
                                                    <img src="{{ vente.image_produit.url }}" alt="{{ vente.nom_produit }}" class="img-thumbnail" style="max-height: 50px;">
                                                    {% else %}
                                                    <span class="text-muted">Aucune image</span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-end">{{ vente.prix_achat|format_prix}} FG</td>
                                                <td class="text-end">{{ vente.prix_vente|format_prix}} FG</td>
                                                <td class="text-end">{{ vente.quantite_vendue }}</td>
                                                <td class="text-end text-{% if vente.get_profit_unitaire >= 0 %}success{% else %}danger{% endif %}">
                                                    {{ vente.get_profit_unitaire|format_prix }} FG
                                                </td>
                                                <td class="text-end">{{ vente.get_total|format_prix}} FG</td>
                                                <td>{{ vente.date_vente|date:"d/m/Y" }}</td>
                                                <td>
                                                    <span class="badge bg-success">Terminée</span>
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="9" class="text-center">Aucune vente terminée</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Pagination -->
                                {% if ventes_terminees.paginator.num_pages > 1 %}
                                <nav aria-label="Page navigation" class="mt-3">
                                    <ul class="pagination justify-content-center">
                                        {% if ventes_terminees.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page=1{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="First">
                                                <span aria-hidden="true">&laquo;&laquo;</span>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ ventes_terminees.previous_page_number }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Previous">
                                                <span aria-hidden="true">&laquo;</span>
                                            </a>
                                        </li>
                                        {% endif %}
                                        
                                        {% for num in ventes_terminees.paginator.page_range %}
                                            {% if ventes_terminees.number == num %}
                                            <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                                            {% elif num > ventes_terminees.number|add:'-3' and num < ventes_terminees.number|add:'3' %}
                                            <li class="page-item"><a class="page-link" href="?page={{ num }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ num }}</a></li>
                                            {% endif %}
                                        {% endfor %}
                                        
                                        {% if ventes_terminees.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ ventes_terminees.next_page_number }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Next">
                                                <span aria-hidden="true">&raquo;</span>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ ventes_terminees.paginator.num_pages }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Last">
                                                <span aria-hidden="true">&raquo;&raquo;</span>
                                            </a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                </nav>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>
      
<!-- Script JavaScript -->
     <!-- Lien vers le script Bootstrap pour rendre les icônes interactives -->
     <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     
     <script>
        // Configuration des thèmes
    const themes = {
      light: {
          bg: 'rgba(255, 255, 255, 0.97)',
          text: '#333',
          border: 'rgba(0, 0, 0, 0.1)',
          progress: 'linear-gradient(90deg, rgba(78, 115, 255, 0.8), rgba(46, 204, 113, 0.8))'
      }
    };
    
    // Fonction pour jouer le son avec gestion moderne des erreurs
    function playNotificationSound() {
      const sound = document.getElementById('notification-sound');
      if (!sound) return;
    
      const playSound = () => {
          sound.currentTime = 0;
          sound.volume = 0.8;
          sound.play().catch(e => console.debug("Sound play prevented:", e));
      };
    
      // Essayer de jouer immédiatement
      playSound();
      
      // Si bloqué, attendre une interaction utilisateur
      if (sound.paused) {
          const enableSound = () => {
              playSound();
              document.removeEventListener('click', enableSound);
              document.removeEventListener('keydown', enableSound);
          };
          document.addEventListener('click', enableSound, { once: true });
          document.addEventListener('keydown', enableSound, { once: true });
      }
    }
    
    // Fermeture de notification avec animation fluide
    function closeNotification(closeButton) {
      const notification = closeButton.closest('.notification-modal');
      if (!notification) return;
      
      notification.classList.add('closing');
      setTimeout(() => {
          notification.classList.remove('show', 'closing');
          notification.remove();
      }, 300);
    }
    
    // Affichage de notification avec effets modernes
    function showNotification(notificationElement) {
      // Appliquer le thème light par défaut
      const themeConfig = themes.light;
      
      notificationElement.style.setProperty('--bg-color', themeConfig.bg);
      notificationElement.style.setProperty('--text-color', themeConfig.text);
      notificationElement.style.setProperty('--border-color', themeConfig.border);
      notificationElement.style.setProperty('--progress-gradient', themeConfig.progress);
    
      // Animation d'entrée
      notificationElement.classList.add('show');
      playNotificationSound();
      
      // Barre de progression animée
      const progressBar = notificationElement.querySelector('.progress-bar');
      if (progressBar) {
          progressBar.style.width = '100%';
          setTimeout(() => {
              progressBar.style.transition = 'width 5s linear';
              progressBar.style.width = '0%';
          }, 50);
      }
    
      // Fermeture automatique après délai
      let timeoutId = setTimeout(() => {
          notificationElement.classList.add('closing');
          setTimeout(() => notificationElement.remove(), 300);
      }, 5000);
    
      // Réinitialiser le timeout si la souris entre
      notificationElement.addEventListener('mouseenter', () => {
          clearTimeout(timeoutId);
          if (progressBar) progressBar.style.transition = 'none';
      });
    
      // Redémarrer le timeout si la souris sort
      notificationElement.addEventListener('mouseleave', () => {
          if (progressBar) {
              const remaining = (parseFloat(progressBar.style.width) / 100) * 5000;
              progressBar.style.transition = `width ${remaining}ms linear`;
              progressBar.style.width = '0%';
          }
          timeoutId = setTimeout(() => {
              notificationElement.classList.add('closing');
              setTimeout(() => notificationElement.remove(), 300);
          }, progressBar ? remaining : 5000);
      });
    }
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.notification-modal').forEach(notification => {
          showNotification(notification);
      });
    });
    
    // Gestion des clics en dehors pour fermer
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.notification-modal')) {
          document.querySelectorAll('.notification-modal.show').forEach(modal => {
              modal.classList.add('closing');
              setTimeout(() => modal.remove(), 300);
          });
      }
    });
        </script>   
        
        <script>
            // Graphique des ventes par mois
            const ctx1 = document.getElementById('ventesParMoisChart').getContext('2d');
            const ventesParMoisChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: [{% for item in sales_trends.ventes_par_mois %}'{{ item.mois }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
                    datasets: [{
                        label: 'Ventes',
                        data: [{% for item in sales_trends.ventes_par_mois %}{{ item.total }}{% if not forloop.last %}, {% endif %}{% endfor %}],
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' unités';
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Ventes mensuelles',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantité vendue',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
            
            // Graphique des ventes par jour de semaine
            const ctx2 = document.getElementById('ventesParJourChart').getContext('2d');
            const ventesParJourChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: [{% for item in sales_trends.ventes_par_jour %}'{{ item.jour }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
                    datasets: [{
                        label: 'Ventes',
                        data: [{% for item in sales_trends.ventes_par_jour %}{{ item.total }}{% if not forloop.last %}, {% endif %}{% endfor %}],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' unités';
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Ventes par jour de semaine',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantité vendue',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
            </script>
            <script>
                const ventesForm = document.getElementById("ventesForm");
                const validateBtn = document.getElementById("validateSelected");
                const deleteBtn = document.getElementById("deleteSelected");
                let alreadySubmitted = false;
            
                function submitFormWithAction(action) {
                    if (alreadySubmitted) return;
                    alreadySubmitted = true;
            
                    // Affiche les spinners
                    const validateSpinner = validateBtn.querySelector('.mini-spinner');
                    const deleteSpinner = deleteBtn.querySelector('.mini-spinner');
                    
                    if (action === "update_ventes" && validateSpinner) {
                        validateSpinner.style.display = 'inline-block';
                    } else if (deleteSpinner) {
                        deleteSpinner.style.display = 'inline-block';
                    }
            
                    document.getElementById("formActionInput").value = action;
            
                    // Désactivation des boutons
                    validateBtn.disabled = true;
                    deleteBtn.disabled = true;
            
                    ventesForm.submit();
                }
            
                validateBtn.addEventListener("click", function () {
                    submitFormWithAction("update_ventes");
                });
            
                deleteBtn.addEventListener("click", function () {
                    submitFormWithAction("delete_ventes");
                });
            
                // Select All
                document.getElementById("selectAll").addEventListener("change", function () {
                    const checkboxes = document.querySelectorAll("input[name='vente_id']");
                    checkboxes.forEach(cb => cb.checked = this.checked);
                });
            
                // Réinitialisation des spinners si la page est rechargée sans soumission
                window.addEventListener('pageshow', function() {
                    document.querySelectorAll('.mini-spinner').forEach(spinner => {
                        spinner.style.display = 'none';
                    });
                });
            </script>
        <script>
            // Toggle IA Content
            document.getElementById('toggleIA').addEventListener('click', function() {
                const content = document.getElementById('iaContent');
                const toggleText = this.querySelector('.toggle-text');
                
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    toggleText.textContent = 'Réduire';
                    this.innerHTML = '<i class="fas fa-eye-slash me-1"></i> Réduire';
                } else {
                    content.style.display = 'none';
                    toggleText.textContent = 'Explorer';
                    this.innerHTML = '<i class="fas fa-eye me-1"></i> Explorer';
                }
            });
        </script>
        
     <script>

                // Fonction pour ouvrir et fermer le sidebar
    const menuBtn = document.querySelector('.menu-btn');
    const sidebar = document.querySelector('.sidebar');
    const body = document.querySelector('body');

    function toggleSidebar() {
        sidebar.classList.toggle('active');
        if (sidebar.classList.contains('active')) {
            body.classList.add('no-scroll');
        } else {
            body.classList.remove('no-scroll');
        }
    }

    function closeSidebar() {
        sidebar.classList.remove('active');
        body.classList.remove('no-scroll');
    }

    // Fermer le sidebar en cliquant en dehors
    document.addEventListener('click', function(event) {
        const isClickInsideSidebar = sidebar.contains(event.target);
        const isClickOnMenuBtn = menuBtn.contains(event.target);
        
        if (!isClickInsideSidebar && !isClickOnMenuBtn && sidebar.classList.contains('active')) {
            closeSidebar();
        }
    });


  </script>

  <!-- Bootstrap JS (facultatif pour certaines interactions) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
